!function(e,r,n){function t(e){var r=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,n=/([^\s,]+)/g,t=e.toString().replace(r,""),i=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(n);return null===i&&(i=[]),i}function i(e){var r={};if(r.localServices={},e.length>0){if(r.source=e[0],r.target=e[0],c.isPlainObject(e[0])){var n=e[0];r.target=n.target,r.source=n.source,r.instance=n.instance}if(e.length>1){var t=c.isString(e[0])||c.isArray(e[0]);t?(c.isArray(e[0])?r.source=e[0]:r.source=c.isString(e[0])?[e[0]]:e[0],c.isFunction(e[1])&&(r.target=e[1]),c.isFunction(e[2])&&(r.target=e[2])):(c.isFunction(e[1])&&(r.callReady=e[1]),c.isPlainObject(e[1])&&(r.localServices=e[1]))}3===e.length&&(c.isPlainObject(e[1])&&(r.localServices=e[1]),c.isFunction(e[2])&&(r.callReady=e[2]))}return r.target=r.target||function(){},r.source=r.source?r.source:r.target,r.callReady=r.callReady||function(){},r}var s,c=e?require("lodash"):n._,a=e?require("promise"):n.Promise,s=e?r:{},u=e?require("log4js").getLogger("realm"):void 0,o={fatal:function(e){return u?u.fatal(e):console.error(e)}};s.__wires_services_cached__=s.__wires_services_cached__||{};var _=function(e){return e&&c.isFunction(e.then)&&c.isFunction(e["catch"])},l=function(e,r){return new a(function(n,t){var i=[],s=c.isPlainObject(e),a=-1,u=function(){if(a++,!(a<c.size(e)))return n(i);var o,l;if(s?(o=c.keys(e)[a],l=e[o]):(o=a,l=e[a]),_(l))l.then(function(e){i.push(e),u()})["catch"](t);else{var f=r.call(r,l,o);_(f)?f.then(function(e){i.push(e),u()})["catch"](t):(i.push(f),u())}};u()})},f={each:l,service:function(){this.register.apply(this,arguments)},module:function(e,r,n){n=n||{},n.cache=!0,this.register.apply(this,[e,r,n,!0])},register:function(e,r,n,t){var i=null,a=r;c.isArray(r)&&(i=r,a=n),s.__wires_services__=s.__wires_services__||{},s.__wires_services__[e]={name:e,target:a,args:i,cache:t}},isRegistered:function(e){return s.__wires_services__&&void 0!==s.__wires_services__[e]},requirePackage:function(e){var r={},n=this;return l(s.__wires_services__,function(t,i){var s=0===i.indexOf(e)?e:!1;return s[1]?n.require([i],function(e){r[i]=e}):void 0}).then(function(){return r})},storeModule:function(e,r){s.__wires_services_cached__[e]=r},require:function(){var e=i(arguments),r=this,n=e.localServices,u=c.isArray(e.source)?e.source:t(e.source),_=e.target,f=(e.callReady,e.instance),h=s.__wires_services__,v=new a(function(t,i){var a=[],v=c.merge(n,h);for(var g in u){var d=(u[g],u[g]);if(!v[d])return o.fatal("Error while injecting variable '"+d+"' into function \n"+e.source.toString()),i({status:500,message:"Service with name '"+d+"' was not found "});a.push(v[d])}return l(a,function(e){if(e.cache&&void 0!==s.__wires_services_cached__[e.name])return s.__wires_services_cached__[e.name];var t=e.target,i=e.args;if(c.isFunction(t)){var a=[];return a=i?[i,n,t]:[t,n],r.require.apply(r,a).then(function(n){return e.cache&&r.storeModule(e.name,n),n})}return t||e}).then(function(e){return _.apply(f||e,e)}).then(t)["catch"](i)});return v}};f.module("realm.bridge.Request",function(){return function(e,r){return new a(function(n,t){var i=new window.XMLHttpRequest;i.open("POST","/_realm_/bridge/"+e,!0),i.onreadystatechange=function(){return 4==i.readyState&&200===this.status?n(JSON.parse(this.response)):t({status:this.status,response:this.response})},i.send(r?JSON.stringify(r):"{}")})}}),n.realm=f}("undefined"!=typeof module&&module.exports,"undefined"!=typeof module&&module.exports?global:this,this);